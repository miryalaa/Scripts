# Download agent
Invoke-WebRequest -Uri "https://aka.ms/AzureConnectedMachineAgentWindows" -OutFile "AzureConnectedMachineAgent.msi"

# Install agent silently
msiexec /i AzureConnectedMachineAgent.msi /qn /l*v C:\Temp\Arc_Install.log

# Generate correlation ID
$CorrelationID = (New-Guid).Guid

# Connect the agent with all parameters
azcmagent connect `
  --resource-group "MyRG" `
  --name $env:COMPUTERNAME `
  --location "eastus" `
  --subscription "<subscription-id>" `
  --tenant-id "<tenant-id>" `
  --service-principal-id "<app-id>" `
  --service-principal-secret "<secret>" `
  --auth-type "service-principal" `
  --correlation-id $CorrelationID `
  --cloud "AzureCloud"
